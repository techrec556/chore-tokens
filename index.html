<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chore Token Manager</title>
    <script src="https://www.gstatic.com/firebasejs/9.25.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.25.0/firebase-firestore.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: auto; }
        button { margin: 5px; padding: 10px 15px; cursor: pointer; }
        .token-count { font-size: 1.5em; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        table, th, td { border: 1px solid black; }
        th, td { padding: 10px; text-align: center; }
        th { background-color: #f4f4f4; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Chore Token Manager</h1>
        <p>Track, redeem, and manage tokens with ease.</p>

        <h2>Alyx's Tokens: <span id="alyx-tokens" class="token-count">Loading...</span></h2>
        <h2>Minty's Tokens: <span id="minty-tokens" class="token-count">Loading...</span></h2>

        <h3>Actions</h3>
        <button onclick="redeemToken('alyx', 'chore')">Redeem Chore Token</button>
        <button onclick="redeemToken('alyx', 'goods')">Redeem Goods/Services</button>
        <button onclick="giftTokens()">Gift Tokens</button>

        <h3>Transaction Log</h3>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>User</th>
                    <th>Action</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody id="log-body">
                <tr>
                    <td colspan="4">Loading...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // Firebase configuration (replace with your own)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        const alyxTokensRef = db.collection('users').doc('alyx');
        const mintyTokensRef = db.collection('users').doc('minty');
        const logRef = db.collection('logs');

        async function updateTokens() {
            const alyxDoc = await alyxTokensRef.get();
            const mintyDoc = await mintyTokensRef.get();

            const alyxTokens = alyxDoc.exists ? alyxDoc.data().tokens : 0;
            const mintyTokens = mintyDoc.exists ? mintyDoc.data().tokens : 0;

            document.getElementById('alyx-tokens').textContent = alyxTokens;
            document.getElementById('minty-tokens').textContent = mintyTokens;
        }

        async function redeemToken(user, type) {
            const userRef = user === 'alyx' ? alyxTokensRef : mintyTokensRef;
            const userDoc = await userRef.get();
            const currentTokens = userDoc.exists ? userDoc.data().tokens : 0;

            if (currentTokens <= 0) {
                alert(`${user.charAt(0).toUpperCase() + user.slice(1)} has no tokens left!`);
                return;
            }

            await userRef.update({ tokens: currentTokens - 1 });
            logTransaction(user, `Redeemed a ${type} token`, `Task or service fulfilled`);
            updateTokens();
        }

        async function giftTokens() {
            const amount = parseInt(prompt("Enter the number of tokens to gift:"), 10);
            if (isNaN(amount) || amount <= 0) {
                alert("Invalid token amount!");
                return;
            }
            const recipient = prompt("Gift tokens to: 'alyx' or 'minty'?");
            const recipientRef = recipient === 'alyx' ? alyxTokensRef : mintyTokensRef;
            const recipientDoc = await recipientRef.get();
            const currentTokens = recipientDoc.exists ? recipientDoc.data().tokens : 0;

            await recipientRef.set({ tokens: currentTokens + amount });
            logTransaction('admin', `Gifted tokens`, `+${amount} to ${recipient}`);
            updateTokens();
        }

        async function logTransaction(user, action, details) {
            await logRef.add({
                date: new Date().toISOString(),
                user,
                action,
                details
            });
            renderLog();
        }

        async function renderLog() {
            const logs = await logRef.orderBy('date', 'desc').get();
            const logBody = document.getElementById('log-body');
            logBody.innerHTML = '';
            logs.forEach(doc => {
                const entry = doc.data();
                const row = document.createElement('tr');
                row.innerHTML = `<td>${new Date(entry.date).toLocaleString()}</td><td>${entry.user}</td><td>${entry.action}</td><td>${entry.details}</td>`;
                logBody.appendChild(row);
            });
        }

        // Initialize
        updateTokens();
        renderLog();
    </script>
</body>
</html>
